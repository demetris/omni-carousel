Omni Carousel Library Map
================================================================================

UPDATED BY CLAUDE CODE ON 2025-07-09  
GENERATED BY CLAUDE CODE ON 2025-07-01


Architecture overview
----------------------------------------

The omni-carousel library follows a **modular, event-driven architecture** with clear separation of concerns:

-   **Core**: Configuration, types, and main carousel creation
-   **DOM**: DOM manipulation and element interactions  
-   **Features**: Individual carousel features (buttons, indicators, scrolling)
-   **Handlers**: Event handlers for native and custom events
-   **Navigation**: Scrolling and navigation logic
-   **State**: State management and updates
-   **Utils**: Utility functions and browser feature detection


Core module (`/lib/core/`)
----------------------------------------

### carousel.ts

Main entry point for creating carousel instances
-   `createOmniCarousel(root, options?)` - Factory function returning public API
-   Manages lifecycle: init, setup, destroy
-   Sets up observers: ResizeObserver, IntersectionObserver
-   Central orchestrator for all other modules

### types.ts

TypeScript type definitions for the entire library
-   `OmniAPI` - Public API interface
-   `Options` - User configuration options
-   `Config` - Full configuration after merging
-   `State` - Dynamic carousel state
-   `Context` - Combined context object
-   `OmniEvents` - Custom event types

### config.ts

Configuration merging and validation

-   `mergeConfig(options?)` - Merges user options with defaults

### defaults.ts

Default configuration values

-   `defaults` - Default options object

### internal-config.ts

Internal constants and configuration

-   `internalConfig` - CSS classes, selectors, data attributes


DOM module (`/lib/dom/`)
----------------------------------------

### elements.ts

DOM element selection and validation

-   `getElements(root, selectors)` - Queries carousel elements

### attributes.ts

DOM attribute management

-   `captureInitialAttributes()` - Stores initial states
-   `resetElementAttributes()` - Restores original attributes
-   `setElementAttributes()` - Sets carousel attributes
-   `ensureTrackPositioned()` - Ensures proper CSS positioning

### styles.ts

CSS class and style management

-   `clearItemAttributes()` - Removes carousel attributes
-   `getScrollSnapAlign()` - Gets scroll-snap-align value
-   `updateCenterItem()` - Updates centered item
-   `updateCenterGroupItem()` - Updates centered group
-   `updateItem()` - General item updates


Features module (`/lib/features/`)
----------------------------------------

### buttons.ts

Navigation button state management

-   `updateButtons()` - Updates all button states
-   `updateBackwardButtons()` - Updates prev/start buttons
-   `updateForwardButtons()` - Updates next/end buttons

### indicators.ts

Indicator button creation and management

-   `addIndicators()` - Creates indicator buttons
-   `centerIndicators()` - Centers overflowing indicators
-   `clearIndicators()` - Removes indicators
-   `updateIndicator()` - Updates individual indicator
-   `updateIndicatorOverflow()` - Manages overflow state

### scroll.ts

Custom scrolling logic

-   `scrollToCenter()` - Centers elements or groups of elements

### invisible-anchor.ts

Invisible element hack for centering multiple elements as a group

-   `createInvisibleAnchor()` - Creates invisible element to overlay on group
-   `placeInvisibleAnchor()` - Positions element over group to center
-   Enables `scrollIntoView()` to center multiple elements as one unit
-   Chrome/Blink requires new element per scroll (forceNew=true)
-   Firefox/Safari can reuse the same invisible element

### Navigation helpers

-   **steps-one.ts** - Single-step navigation
-   **steps-all-align-start.ts** - Start-aligned navigation
-   **steps-all-align-center.ts** - Center-aligned navigation
-   **steps-auto-align-all.ts** - Auto-step navigation (renamed from steps-many-align-all.ts)

### utils.ts

Feature-specific utilities

-   `calculateCenterScrollPosition()` - Center scroll calculation
-   `getFallbackItem()` - Fallback navigation item
-   `getRectCenterX()` - Element center coordinate
-   `getInboundItems()` - Calculates items that fit when scrolling (auto-step mode)


Handlers module (`/lib/handlers/`)
----------------------------------------

### Native DOM event handlers

-   **event-click.ts** - Button and indicator clicks
-   **event-keyboard.ts** - Keyboard navigation (arrows)
-   **event-scrollend.ts** - Scroll completion
-   **event-transitionend.ts** - CSS transition completion

### Custom Omni event handlers

-   **omni-event-init.ts** - Carousel initialization
-   **omni-event-setup.ts** - Setup when overflow detected
-   **omni-event-destroy.ts** - Cleanup handling
-   **omni-event-dimensions-change.ts** - Resize handling
-   **omni-event-visibility-change.ts** - Item visibility changes

### Observer handlers

-   **observation-intersection.ts** - IntersectionObserver entries
-   **observation-resize.ts** - ResizeObserver entries


Navigation module (`/lib/navigation/`)
----------------------------------------

### index.ts

Central navigation logic

-   `navigate()` - Main navigation function
-   Determines navigation mode from config
-   Handles 5 different navigation modes
-   Coordinates with features for scrolling


State module (`/lib/state/`)
----------------------------------------

### set.ts

State creation and initialization

-   `createState()` - Creates initial state
-   `populateMaps()` - Creates slide index mappings

### update.ts

State update logic

-   `updateIntersectionState()` - Updates visibility state


Utils module (`/lib/utils/`)
----------------------------------------

### arrays.ts

Array manipulation

-   `insertInOrder()` - Ordered insertion
-   `removeAtIndex()` - Element removal

### browser-support.ts

Feature detection

-   `hasBlinkEngine()` - Chrome/Blink detection
-   `supportsRequirements()` - Returns detailed browser compatibility results with specific missing features
-   `supportsScrollend()` - Event support check

### debounce.ts

-   `debounce()` - Function debouncing

### measurements.ts

Item spacing calculation

-   `getItemSpacing()` - Calculates spacing between slides, caches result in state


Key architectural patterns
----------------------------------------

### Event flow

DOM events → Handlers → Custom events → State updates → UI updates

### Data flow

Context object (config + state + elements + utils) passed through all functions

### Module dependencies

-   Core orchestrates all modules
-   Handlers coordinate features and DOM
-   Navigation uses features for scrolling
-   Utils provides cross-cutting functionality

### Lifecycle

init() → setup() → active carousel → destroy()

### Performance optimizations

-   State-based caching for expensive calculations
-   Observers for efficient change detection
-   Passive event listeners
-   Minimal DOM manipulation


Public API
----------------------------------------

```typescript
const carousel = createOmniCarousel(element, options);

// Navigation
carousel.next();
carousel.prev();
carousel.goTo(index);

// Lifecycle
carousel.init();
carousel.setup();
carousel.destroy();

// Events
carousel.on('omni:visibility:change', callback);
carousel.on('omni:nav:next', callback);
// ... and more
```
